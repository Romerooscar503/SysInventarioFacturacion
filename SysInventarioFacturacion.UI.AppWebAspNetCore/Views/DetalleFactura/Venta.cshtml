@model IEnumerable<SysInventarioFacturacion.EntidadesDeNegocio.DetalleFactura>

@{
    ViewData["Title"] = "Venta";
    int numPage = 1;
    int numRegistros = 0;
    int numRegistrosPorPage = 10;
    int[] tops = { 10, 20, 50, 100, 500, 1000, 10000, -1 };
    int topActual = Convert.ToInt32(ViewBag.Top);
    List<SysInventarioFacturacion.EntidadesDeNegocio.Factura> facturas = ViewBag.Facturas as List<SysInventarioFacturacion.EntidadesDeNegocio.Factura>;
    List<SysInventarioFacturacion.EntidadesDeNegocio.Producto> productos = ViewBag.Producto as List<SysInventarioFacturacion.EntidadesDeNegocio.Producto>;
    List<SysInventarioFacturacion.EntidadesDeNegocio.DetalleFactura> detalleFacturas = new List<SysInventarioFacturacion.EntidadesDeNegocio.DetalleFactura>();

}


<h1>Creación de ventas</h1>

<div class="row">

    <!-- Cuadro de búsqueda de productos... -->
    <div class="row mt-2">
        <div class="col-sm-6">
            <div class="card border-info">
                <h6 class="TextLitlle">Busca tus productos</h6>
                <div class="card-body p-2 card-venta">
                <div class="FormContent">
                    <div class="row align-items-star">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="control-label">Código</label>
                                <input type="text" id="txtCodigo" class="form-control" name="codigo" />
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="control-label">Nombre</label>
                                <input type="text" id="txtNombre" class="form-control" name="nombre" />
                            </div>
                        </div>


                    </div>

                    </div>
                </div>
            </div>
        </div>
        <!-- Tabla donde aparecen los productos... -->
        <div class="col-sm-6">
            <div class="card border-info">
                <div class="table-container">
                    <table id="tablaBusqueda" class="tablaBusqueda" style="height:20px">
                        <thead>
                            <tr>
                                <th>Cod</th>

                                <th>
                                    Nombre
                                </th>

                                <th>
                                    Descripcion
                                </th>

                                <th>
                                    Talla
                                </th>
                                <th>
                                    Precio Unitario
                                </th>
                                <th colspan="1">Acciones</th>

                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in productos)
                            {
                                <tr data-page="@numPage">
                                    <td>
                                        @Html.DisplayFor(modelItem => item.Codigo)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.Nombre)
                                    </td>

                                    <td>
                                        <div class="descripcion">
                                            @if (!string.IsNullOrEmpty(item.Descripcion) && item.Descripcion.Length > 50)
                                            {
                                                <span class="short-description">@Html.DisplayFor(modelItem => item.Descripcion.Substring(0, 50))</span>
                                                <span class="full-description" style="display: none;">@Html.DisplayFor(modelItem => item.Descripcion)</span>
                                                <button class="show-more-button">Ver Más</button>
                                            }
                                            else
                                            {
                                                <span class="short-description">@Html.DisplayFor(modelItem => item.Descripcion)</span>
                                            }
                                        </div>
                                    </td>


                                    <td>
                                        @Html.DisplayFor(modelItem => item.Talla)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.PrecioUnitario)
                                    </td>
                                    <td class="botonestabla">
                                        <button class="agregar-producto btn btn-sm btn-success btn-block"
                                            data-codigo="@item.Codigo"
                                            data-nombre="@item.Nombre"
                                            data-descripcion="@item.Descripcion"
                                            data-precio="@item.PrecioUnitario">
                                            <i class="fa fa-plus" aria-hidden="true"></i> Agregar
                                        </button>
                                    </td>

                                </tr>
                                numRegistros++;
                                if (numRegistros == numRegistrosPorPage)
                                {
                                    numPage++;
                                    numRegistros = 0;
                                }
                            }
                            @{
                                if (numRegistros == 0)
                                {
                                    numPage--;
                                }
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

</div>



<hr class="Separation" />

<div class="row mt-3">
    <div class="col-sm-11">
        <div class="table-responsive-sm">
            <table id="tablaDetalleFactura" class="tablaDetalles">
                <thead>
                    <tr>
                        <th>Cantidad</th>
                        <th>Producto</th>
                        <th>Descripcion</th>
                        <th>Precio Unidad</th>
                        <th>Importe Total</th>
                        <th colspan="1">Eliminar</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in detalleFacturas)
                    {
                        <tr data-page="@numPage">
                            <td>
                                @Html.DisplayFor(modelItem => item.Cantidad)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.Producto.Nombre)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.Producto.Descripcion)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.Producto.PrecioUnitario)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.ValorTotal)
                            </td>
                            <td class="botonestabla">
                                <button class="eliminar-producto btn btn-danger" data-id="@item.IdDetalleFactura">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                        numRegistros++;
                        if (numRegistros == numRegistrosPorPage)
                        {
                            numPage++;
                            numRegistros = 0;
                        }
                    }
                    @{
                        if (numRegistros == 0)
                        {
                            numPage--;
                        }
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

<br />
<div class="ContentFormCustomer">
    <div class="card border-info">

        <form asp-controller="DetalleFactura" asp-action="ProcesarFactura" method="post">
            <div class="BarraSuperior">
                <button id="btnTerminarGuardarVenta" type="submit" class="BtnImprimir" data-bs-toggle="modal" data-bs-target="#exampleModal" data-bs-whatever="@@getbootstrap">
                    <i class="fa fa-print" aria-hidden="true"></i> Imprimir y Terminar Venta
                </button>
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal" data-bs-whatever="@@getbootstrap">Open modal for @@getbootstrap</button>
            </div>
            <div class="card-body p-2 card-venta">
                <div class="row align-items-star">

                    <div class="col-md-3">
                        <div class="form-group">
                            <label class="control-label">Nombre</label>
                            <input type="text" id="Descripcion" class="form-control" name="Descripcion" placeholder="Ingrese su nombre" />
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label class="control-label">Telefono</label>
                            <input type="text" id="Telefono" class="form-control" name="Telefono" placeholder="Ingrese su telefono" />
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label class="control-label">Direccion</label>
                            <input type="text" id="Direccion" class="form-control" name="Direccion" placeholder="Ingrese su direccion" />
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label class="control-label">Correo</label>
                            <input type="text" id="Correo" class="form-control" name="Correo" placeholder="Ingrese su correo" />
                        </div>
                    </div>
                </div>
                <br />
                <div class="row align-items-star">
                    <div class="col-sm-4">
                        <div class="input-group input-group-sm mb-2">
                            <div class="form-group">
                                <label class="DataCustomer" for="inputGroupSelect01">Sub Total S/.</label>
                            </div>
                            <input id="txtsubtotal" name="total" readonly type="text" class="form-control" value="0">
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="input-group input-group-sm mb-2">
                            <div class="input-group-prepend">
                                <label class="DataCustomer" for="inputGroupSelect01">IVA.</label>
                            </div>
                            <input id="txtigv" name="impuesto" readonly type="text" class="form-control" value="0">
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="input-group input-group-sm mb-2">
                            <div class="input-group-prepend">
                                <label class="DataCustomer" for="inputGroupSelect01">Total.</label>
                            </div>
                            <input id="txttotal" name="totalpagado" readonly type="text" class="form-control" value="0">
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="input-group input-group-sm mb-2">
                            <div class="input-group-prepend">
                                <label class="DataCustomer" for="inputGroupSelect01">Pago Con:</label>
                            </div>
                            <input id="txtmontopago" type="text" class="form-control" autocomplete="off">
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="input-group input-group-sm mb-2">
                            <label class="DataCustomerFormaP" for="inputGroupSelect01">F. Pago</label>
                            <select name="FormaDePago" class="form-control">
                                <option selected value="1">EFECTIVO</option>
                                <option value="2">TARJETA</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <button id="btncalcular" type="button" class="btnCalcular">
                            <i class="fas fa-dollar-sign"></i> Calcular
                        </button>
                    </div>
                </div>
            </div>
            <br />

            <div class="col-sm-12">
                <div class="BarraInferio">
                    <div class="card-body p-2">
                        <div class="row">
                            <div class="col-sm-10">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>





<!-- Modal del ticket -->
<!-- Modal del ticket -->
<div class="modal fade" id="ticketModal" tabindex="-1" role="dialog" aria-labelledby="ticketModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <img src="~/IMG/Logo.png" alt="Logo" style="max-width: 100px; max-height: 100px; margin-right: 10px;">
            <div class="modal-header">
                <h5 class="modal-title" id="ticketModalLabel">Ticket de Venta</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="ticketContent">
                <!-- Contenido del ticket se llenará dinámicamente aquí -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                <button type="button" class="btn btn-primary" id="btnImprimirTicket">Imprimir</button>
            </div>
        </div>
    </div>
</div>


